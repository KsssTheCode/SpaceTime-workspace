<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="spaceMapper">

	<resultMap id="spaceTypeResultSet" type="spaceType">
		<result column="STYPE_NO" property="stypeNo" />
		<result column="STYPE_NAME" property="stypeName" />
	</resultMap>
	
	<resultMap id="spaceResultSet" type="space">
		<result column="SPACE_NO" property="spaceNo" />
		<result column="SPACE_TITLE" property="spaceTitle" />
		<result column="SPACE_SUBTITLE" property="spaceSubTitle" />
		<result column="SPACE_INFO" property="spaceInfo" />
		<result column="HOUR_PRICE" property="hourPrice" />
		<result column="MAX_PEOPLE" property="maxPeople" />
		<result column="ADDRESS_DEFAULT" property="addressDefault" />
		<result column="ADDRESS_DETAIL" property="addressDetail" />
		<result column="TEL" property="tel" />
		<result column="HASHTAG" property="hashtag" />
		<result column="SPACE_STATUS" property="spaceStatus" />
		<result column="COUNT" property="count" />
		<result column="LATITUDE" property="latitude" />
		<result column="LONGITUDE" property="longitude" />
		<result column="OPEN_TIME" property="openTime" />
		<result column="CLOSE_TIME" property="closeTime" />
		<result column="DENY_MESSAGE" property="denyMessage" />
		<result column="HOST_NO" property="hostNo" />
		<result column="STYPE_NO" property="stypeNo" />
		<collection resultMap="spaceAttachmentResultSet" property="spaceAttachment" />
	</resultMap>
	
	<resultMap id="spaceAttachmentResultSet" type="spaceAttachment">
		<result column="ATTACHMENT_NO" property="attachmentNo" />
		<result column="ATTACHMENT_RENAME" property="attachmentReName" />
		<result column="ATTACHMENT_UPLOAD_DATE" property="attachmentUploadDate" />
		<result column="ATTACHMENT_STATUS" property="attachmentStatus" />
		<result column="ATTACHMENT_LEVEL" property="attachmentLevel" />
		<result column="SPACE_NO" property="spaceNo" />
	</resultMap>
	
	<!-- 	공간 타입 리스트 전체 선택 -->
	<select id="selectSpaceTypeList" resultMap="spaceTypeResultSet">
		SELECT *
		FROM STYPE			
	</select>
	
	<!-- 공간 첨부파일 추가 -->
	<insert id="insertSpaceAttachment" parameterType="java.util.List">
	insert INTO SPACE_ATTACHMENT(ATTACHMENT_NO
										 , ATTACHMENT_RENAME
										 , ATTACHEMNT_LEVEL
										 , SPACE_NO)
	SELECT SEQ_ANO.NEXTVAL, A.* from(
	 <foreach item="attachList" collection="list" separator="UNION ALL " >
	   SELECT #{attachList.attachmentReName} AS ATTACHMENT_RENAME,
	          #{attachList.attachmentLevel} AS ATTACHEMNT_LEVEL,
	          #{attachList.spaceNo} AS SPACE_NO
	   FROM DUAL
	 </foreach>) A
	</insert>
<!-- 	정현 -->
<!-- 	<insert  id="insertSpaceAttachment2" parameterType="java.util.List"> -->
<!-- 	<foreach collection="list" item="attachList" open="INSERT ALL" close="SELECT * FROM DUAL"  separator=" "> -->
<!-- 	 	INTO SPACE_ATTACHMENT (ATTACHMENT_NO -->
<!-- 										 , ATTACHMENT_RENAME -->
<!-- 										 , ATTACHEMNT_LEVEL -->
<!-- 										 , SPACE_NO) -->
<!-- 					 		VALUES	 (SEQ_ANO.NEXTVAL -->
<!-- 								   		 , #{attachList.attachmentReName} -->
<!-- 								   		 , #{attachList.attachmentLevel} -->
<!-- 								   		 , #{attachList.spaceNo}) -->
<!-- 	</foreach> -->
<!-- 	</insert> -->

<!-- 	마지막 공간 PK 가져오기 -->
	<select id="selectSpaceNo" resultType="_int">
		SELECT SPACE_NO
		FROM (SELECT SPACE_NO
		      FROM SPACE       
		      ORDER BY SPACE_NO DESC)
		WHERE ROWNUM =1
	</select>
		
	<!-- 	공간 추가-->
	<insert id="insertSpace" parameterType="space">
		INSERT INTO SPACE (SPACE_NO
						 , SPACE_TITLE
						 , SPACE_SUBTITLE
						 , SPACE_INFO
						 , HOUR_PRICE
						 , MAX_PEOPLE
						 , ADDRESS_DEFAULT
						 , ADDRESS_DETAIL
						 , TEL
						 , HASHTAG
						 , LATITUDE
						 , LONGITUDE
						 , OPEN_TIME
						 , CLOSE_TIME
						 , HOST_NO
						 , STYPE_NO)
				   VALUES (SEQ_SNO.NEXTVAL
				   		 , #{spaceTitle}
				   		 , #{spaceSubTitle}
				   		 , #{spaceInfo}
				   		 , #{hourPrice}
				   		 , #{maxPeople}
				   		 , #{addressDefault}
				   		 , #{addressDetail}
				   		 , #{tel}
				   		 , #{hashtag}
				   		 , #{latitude}
				   		 , #{longitude}
				   		 , #{openTime}
				   		 , #{closeTime}
				   		 , #{hostNo}
				   		 , #{stypeNo})
	</insert>
	
<!-- 	호스트 공간 개수 -->
	<select id="selectHostSpaceListCount" parameterType="_int" resultType="_int">
		SELECT COUNT(*)
		FROM SPACE
		WHERE HOST_NO = #{memNo}
	</select>
<!-- 	호스트 공간 리스트 -->
	<select id="selectHostSpaceList" parameterType="_int" resultMap="spaceResultSet">
		SELECT SPACE_NO
			 , SPACE_TITLE
			 , HOUR_PRICE
			 , ADDRESS_DEFAULT
			 , SPACE_STATUS
			 , DENY_MESSAGE
			 , ATTACHMENT_RENAME
		FROM SPACE
		JOIN SPACE_ATTACHMENT USING(SPACE_NO)
		WHERE HOST_NO = #{memNo}
		AND ATTACHEMNT_LEVEL = 1
	</select>
	
	<!-- 지도에 표시될 공간 갯수 조회 -성훈-->
	<select id="selectListCountForMap" parameterType="hashmap" resultType="_int">
		SELECT COUNT(*)
		  FROM SPACE
		 WEHRE LATITUDE BETWEEN #{max_lat} AND #{min_lat}
		   AND LONGITUDE BETWEEN #{max_lng} AND #{min_lng}
		   AND SPACE_STATUS = 'Y'
	</select>
	
	
	<!-- 지도 공간 리스트 (사진형게시판) -성훈 -->
	<select id="selectListForMap" parameterType="hashmap" resultMap="spaceResultSet">
		SELECT SPACE_NO, 
		       SPACE_TITLE, 
		       HOUR_PRICE, 
		       HASHTAG, 
		       LATITUDE, 
		       LONGITUDE, 
		       ATTACHMENT_RENAME
		  FROM SPACE
		  LEFT JOIN SPACE_ATTACHMENT USING (SPACE_NO)
		 WEHRE LATITUDE BETWEEN #{max_lat} AND #{min_lat}
		   AND LONGITUDE BETWEEN #{max_lng} AND #{min_lng}
		   AND SPACE_STATUS = 'Y'
		   AND ATTACHMENT_LEVEL = 1
	</select>
	
	
</mapper>
